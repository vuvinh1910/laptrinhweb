<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh Sách Dịch Vụ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/public/header-navbar.css}">
    <link rel="stylesheet" th:href="@{/css/public/list-service.css}">
    <link rel="stylesheet" th:href="@{/css/public/popup-confirm.css}">
    <link rel="stylesheet" th:href="@{/css/public/popup-login.css}">
    <script th:src="@{/js/popup.js}" defer></script>
    <script th:src="@{/js/confirm.js}" defer></script>
</head>
<body class="service-page">
<!-- Nhúng Navbar -->
<div th:replace="~{/public/header-navbar :: navbar}"></div>

<!-- Nội dung chính -->
<section class="py-5">
    <div class="container">
        <h1 class="text-center mb-4">Danh Sách Dịch Vụ</h1>
        <div class="row">
            <!-- Filter Sidebar (Bên trái) -->
            <div class="col-md-3">
                <div class="filter-sidebar">
                    <h5>Lọc Dịch Vụ</h5>
                    <form th:action="@{/public/services}" method="get">
                        <div class="mb-3">
                            <label for="serviceType" class="form-label">Loại Dịch Vụ</label>
                            <select name="serviceType" id="serviceType" class="form-control">
                                <option value="">Tất cả dịch vụ</option>
                                <option value="t">Tour du lịch</option>
                                <option value="n">Nhà hàng</option>
                                <option value="l">Lặn biển</option>
                                <option value="d">Du thuyền</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="minPrice" class="form-label">Giá tối thiểu (VNĐ)</label>
                            <input type="number" name="minPrice" id="minPrice" class="form-control" placeholder="Nhập giá tối thiểu" min="0">
                        </div>
                        <div class="mb-3">
                            <label for="maxPrice" class="form-label">Giá tối đa (VNĐ)</label>
                            <input type="number" name="maxPrice" id="maxPrice" class="form-control" placeholder="Nhập giá tối đa" min="0">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Lọc</button>
                    </form>
                </div>
            </div>

            <!-- Danh sách dịch vụ (Bên phải) -->
            <div class="col-md-9">
                <div class="row g-4" th:each="service : ${services}">
                    <div class="col-12">
                        <div class="card">
                            <!-- Ảnh bên trái với điều kiện -->
                            <img th:with="firstChar=${service.codeName != null ? service.codeName.substring(0,1) : ''}"
                                 th:src="@{${firstChar == 't' ? '/img/dulich.jpg' :
                             firstChar == 'n' ? '/img/nhahang.jpg' :
                             firstChar == 'l' ? '/img/lanbien.jpg' :
                             firstChar == 'd' ? '/img/duthuyen.jpg' :
                             '/img/service-ads.jpg'}}"
                                 alt="Service Image" th:alt="${service.serviceName}">
                            <!-- Nội dung bên phải -->
                            <div class="card-body">
                                <div>
                                    <h5 th:text="${service.serviceName}">Tên Dịch Vụ</h5>
                                    <p th:utext="${service.serviceDetail + '<br>' + service.servicePrice}">Chi tiết dịch vụ</p>
                                </div>
                                <!-- Nút Book Now -->
                                <div class="btn-container">
                                    <form th:action="@{/users/booking-services/{serviceCodeName}(serviceCodeName=${service.codeName})}" method="post">
                                        <input type="hidden" name="serviceCodeName" th:value="${service.codeName}" />
                                        <button type="submit" class="del-button">Đặt Ngay</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Thông báo nếu không có dịch vụ -->
                <div class="text-center mt-4" th:if="${#lists.isEmpty(services)}">
                    <p>Không tìm thấy dịch vụ nào phù hợp.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Popup khi đã đăng nhập -->
<div id="confirmationPopup" style="display:none;">
    <p>Bạn muốn đặt dịch vụ này?</p>
    <button id="confirmDelete">Xác nhận</button>
    <button id="cancelDelete">Hủy</button>
</div>

<!-- Popup khi chưa đăng nhập -->
<div id="confirmationPopup-login" style="display:none;">
    <p>Bạn cần đăng nhập để mua. Bạn có muốn đăng nhập không?</p>
    <button id="confirm">Xác nhận</button>
    <button id="cancel">Hủy</button>
</div>

<!-- Modal thông báo -->
<div id="myModal" class="modal" th:if="${result}">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p class="result-popup" th:text="${result}">Thông báo</p>
        <div class="modal-buttons" th:if="${bookingId != 'no'}">
            <!-- Nút OK chuyển đến trang thanh toán -->
            <a th:href="@{/users/booking-services/{bookingId}/payment(bookingId=${bookingId})}" class="pay-button">Ok</a>
            <!-- Nút Hủy đóng modal hoặc quay lại -->
            <button class="btn btn-cancel" onclick="closeModal()">Hủy</button>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>