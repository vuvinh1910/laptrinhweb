<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/user/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/public/header-navbar.css}">
    <link rel="stylesheet" th:href="@{/css/user/list-booking-room.css}">
    <link rel="stylesheet" th:href="@{/css/public/popup-confirm.css}">
    <link rel="stylesheet" th:href="@{/css/public/popup-login.css}">
    <script th:src="@{/js/popup.js}" defer></script>
    <script th:src="@{/js/confirm.js}" defer></script>
</head>
<body class="user-booking-room-list">
<div th:replace="public/header-navbar :: navbar"></div>
<div th:include="user/sidebar :: sidebar" class="sidebar"></div>
<div class="booking-container">
    <h1>Lịch sử Đặt Phòng</h1>
    <div class="booking-row header-row">
        <form>Xóa</form>
        <div>Tên phòng</div>
        <div>Trạng thái</div>
        <div>Ngày nhận phòng</div>
        <div>Ngày trả phòng</div>
        <div>Tổng giá tiền</div>
        <div>Hành động</div> <!-- Nếu bạn có hành động như thanh toán -->
    </div>
    <div th:each="booking : ${bookedRooms}">
        <div class="booking-row">
            <form th:action="@{/users/myInfo/booking-rooms/{roomId}(roomId=${booking.id})}" method="POST"
                  style="display: inline;">
                <input type="hidden" name="_method" value="DELETE">
                <button type="submit" class="del-button">
                    <i class="fas fa-trash-alt"></i> <!-- Icon thùng rác -->
                </button>
            </form>

            <div>
                <a th:href="@{/public/room/{roomId}(roomId=${booking.roomId})}" th:text="${booking.roomName}">Tên
                    phòng</a>
            </div>
            <div th:text="${booking.status}">Trạng thái</div>
            <div th:text="${booking.checkIn}">Ngày nhận phòng</div>
            <div th:text="${booking.checkOut}">Ngày trả phòng</div>
            <div th:text="${booking.totalPrice} + ' VND'">Tổng giá tiền</div>

            <!-- Kiểm tra trạng thái của booking -->
            <div th:if="${booking.status.equals(T(com.example.web_nhom_5.enums.BookingStatus).CANCELLED)}">
                Đã hủy
            </div>

            <div th:if="${booking.status != T(com.example.web_nhom_5.enums.BookingStatus).CANCELLED}">
                <div th:if="${!booking.isPaid}" class="action-buttons">
                    <a th:href="@{/users/booking-rooms/{bookingId}/payment(bookingId=${booking.id})}"
                       class="pay-button">Thanh toán</a>
                    <a th:href="@{/users/booking-rooms/{bookingId}/cancel(bookingId=${booking.id})}"
                       class="cancel-button"
                       onclick="return confirm('Bạn có chắc chắn muốn hủy đặt phòng này?');">Hủy</a>
                </div>
                <div th:if="${booking.isPaid}" class="paid action-buttons"> <!-- Thêm class action-buttons -->
                    <span>Đã thanh toán</span>
                    <a th:href="@{/users/booking-rooms/{bookingId}/cancel(bookingId=${booking.id})}"
                       class="cancel-button"
                       onclick="return confirm('Bạn muốn hủy thanh toán?');">Hủy</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Popup Xác Nhận -->
<div id="confirmationPopup" style="display:none;">
    <p>Bạn có chắc chắn muốn xóa không? Hành động này không thể hoàn tác.</p>
    <button id="confirmDelete">Xóa</button>
    <button id="cancelDelete">Hủy</button>
</div>

<!--  tra ve thong bao-->
<div id="myModal" class="modal" th:if="${result}">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p class="result-popup" th:text="${result}">Thông báo</p>
    </div>
</div>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
