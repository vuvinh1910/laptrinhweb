<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/user/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/public/header-navbar.css}">
    <link rel="stylesheet" th:href="@{/css/user/list-booking-room.css}">
    <!-- List.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
    <!-- CSS tùy chỉnh -->
    <style>
        .pagination {
            margin-top: 20px;
            justify-content: center;
            display: flex;
        }
        .pagination li {
            margin: 0 5px;
        }
        .pagination .active a {
            background-color: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }
        .pagination a {
            color: #0d6efd;
            padding: 8px 16px;
            text-decoration: none;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .pagination a:hover {
            background-color: #183d59;
        }
    </style>
</head>
<body class="user-booking-room-list">
<div th:replace="public/header-navbar :: navbar"></div>
<div th:include="user/sidebar :: sidebar" class="sidebar"></div>
<div class="booking-container">
    <h1>Lịch sử Đặt Phòng</h1>
    <div id="bookingList">
        <div class="booking-row header-row">
            <form>Xóa</form>
            <div>Tên phòng</div>
            <div>Trạng thái</div>
            <div>Ngày nhận phòng</div>
            <div>Ngày trả phòng</div>
            <div>Tổng giá tiền</div>
            <div>Hành động</div>
        </div>
        <div class="list">
            <div class="booking-row item" th:each="booking : ${bookedRooms}">
                <form th:action="@{/users/myInfo/booking-rooms/{roomId}(roomId=${booking.id})}" method="POST"
                      style="display: inline;">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit" class="del-button">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </form>
                <div>
                    <span class="roomName" th:text="${booking.roomName}">Tên phòng</span><br/>
                    <a th:href="@{/users/booking-rooms/{bookingId}/detail(bookingId=${booking.id})}">Chi Tiết →</a>
                </div>
                <div class="status" th:text="${booking.status}">Trạng thái</div>
                <div class="checkIn" th:text="${booking.checkIn}">Ngày nhận phòng</div>
                <div class="checkOut" th:text="${booking.checkOut}">Ngày trả phòng</div>
                <div class="totalPrice" th:text="${booking.totalPrice} + ' VND'">Tổng giá tiền</div>
                <!-- Kiểm tra trạng thái của booking -->
                <div th:if="${booking.status.equals(T(com.example.web_nhom_5.enums.BookingStatus).COMPLETED)}">
                    <div class="paid action-buttons">
                        <span>Đã trả phòng</span>
                    </div>
                </div>
                <div th:if="${booking.status.equals(T(com.example.web_nhom_5.enums.BookingStatus).CONFIRMED)}">
                    <div th:if="${booking.isPaid}" class="paid action-buttons">
                        <span>Đã thanh toán</span>
                        <button type="button" class="cancel-button open-cancel-modal"
                                th:data-booking-id="${booking.id}">
                            Hủy
                        </button>
                    </div>
                    <div th:if="${!booking.isPaid}" class="paid action-buttons">
                        <span>Đã Hoàn Tiền</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Phân trang -->
        <ul class="pagination"></ul>
    </div>
</div>
<div id="cancelRequestModal" class="refundModal">
    <div class="refund-modal-content">
        <span class="refund-close-button">×</span>
        <h2>Yêu cầu Hủy Đặt Phòng & Hoàn tiền</h2>
        <p>Vui lòng cung cấp thông tin ngân hàng để chúng tôi xử lý hoàn tiền (nếu đủ điều kiện) và lý do hủy.</p>
        <form id="cancelRefundForm" method="POST" action="">
            <input type="hidden" name="id" id="modalBookingId">
            <div class="refund-form-group">
                <label for="bankType">Tên Ngân hàng:</label>
                <input type="text" id="bankType" name="bankType" required>
            </div>
            <div class="refund-form-group">
                <label for="bankCode">Số Tài Khoản:</label>
                <input type="text" id="bankCode" name="bankCode" required>
            </div>
            <div class="refund-form-group">
                <label for="bankHolderName">Tên Chủ Tài khoản:</label>
                <input type="text" id="bankHolderName" name="bankHolderName" required>
            </div>
            <div class="refund-form-group">
                <label for="reason">Lý do hủy:</label>
                <textarea id="reason" name="reason" rows="4" required></textarea>
            </div>
            <button type="submit" class="refund-submit-button">Gửi Yêu cầu Hủy</button>
        </form>
    </div>
</div>
<!-- Thông báo -->
<div id="myModal" class="modal" th:if="${result}">
    <div class="modal-content">
        <span class="close">×</span>
        <p class="result-popup" th:text="${result}">Thông báo</p>
    </div>
</div>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/popup.js}" defer></script>
<script th:src="@{/js/refund.js}" defer></script>
<!-- List.js Initialization -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var options = {
            valueNames: ['roomName', 'status', 'checkIn', 'checkOut', 'totalPrice'],
            page: 10, // Số đặt phòng mỗi trang
            pagination: {
                innerWindow: 2,
                outerWindow: 1,
                paginationClass: 'pagination'
            }
        };
        var bookingList = new List('bookingList', options);
    });
</script>
</body>
</html>